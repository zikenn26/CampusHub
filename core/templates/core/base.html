{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Campus Hub{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="{% static 'core/css/base.css' %}" rel="stylesheet">
</head>
<body class="">
    <header class="site-header">
        <div class="header-inner">
            <div class="brand">
                <a href="{% url 'home' %}" class="brand-link">
                    <div class="brand-logo">CH</div>
                    <div class="brand-text">
                        <span class="brand-title">Campus Hub</span>
                        <span class="brand-subtitle">Study Material Portal</span>
                    </div>
                </a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="{% url 'home' %}" class="{% if request.resolver_match.url_name == 'home' %}active{% endif %}">Dashboard</a></li>
                    <li><a href="{% url 'department_list' %}" class="{% if 'department' in request.path and 'departments' in request.path %}active{% endif %}">Departments</a></li>
                    <li><a href="{% url 'faculty_list' %}" class="{% if 'faculty' in request.path %}active{% endif %}">Faculty</a></li>
                    <li><a href="{% url 'timetable_list' %}" class="{% if 'timetable' in request.path %}active{% endif %}">Timetable</a></li>
                    <li><a href="{% url 'material_list' %}" class="{% if 'materials' in request.path %}active{% endif %}">Study Hub</a></li>
                    {% if request.user.is_authenticated %}
                        <li><a href="{% url 'my_library' %}" class="{% if 'library' in request.path %}active{% endif %}">My Library</a></li>
                    {% endif %}
                    {% if request.user.is_staff or request.user.is_superuser %}
                        <li><a href="{% url 'analytics_top_materials' %}" class="{% if 'analytics' in request.path %}active{% endif %}">Analytics</a></li>
                    {% endif %}
                    {% if request.user.is_authenticated %}
                        {% if request.user.is_staff or request.user.is_superuser or request.user.coordinator_roles.exists %}
                            <li><a href="{% url 'material_moderation_list' %}" class="{% if 'moderation' in request.path %}active{% endif %}">Moderation</a></li>
                        {% endif %}
                        <li><a href="{% url 'material_upload' %}" class="{% if 'upload' in request.path %}active{% endif %}">Upload</a></li>
                    {% endif %}
                    <li><a href="/admin/" target="_blank">Admin</a></li>
                </ul>
            </nav>
            <div class="user-menu">
                <button type="button" class="theme-toggle" id="theme-toggle" title="Toggle theme">
                    ☾
                </button>
                {% if request.user.is_authenticated %}
                    <div class="user-chip">
                        <span class="user-avatar">
                            {{ request.user.first_name|default:request.user.username|first|upper }}
                        </span>
                        <div class="user-meta">
                            <span class="user-name">
                                {{ request.user.get_full_name|default:request.user.username }}
                            </span>
                            <span class="user-role">
                                {% if request.user.is_superuser %}
                                    Super Admin
                                {% elif request.user.is_staff %}
                                    Staff
                                {% else %}
                                    Student
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    <a href="/admin/logout/" class="user-action">Logout</a>
                {% else %}
                    <a href="/admin/login/" class="user-action primary">Login</a>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="site-main">
        <div class="page-container">
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="message message-{{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}

            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="site-footer">
        <div class="footer-inner">
            <span>© {% now "Y" %} Campus Hub</span>
            <span class="footer-meta">Built for internal campus use</span>
        </div>
    </footer>

    <script>
        (function () {
            var body = document.body;
            var toggle = document.getElementById('theme-toggle');
            if (!toggle) return;

            var stored = localStorage.getItem('campus-hub-theme');
            if (stored === 'light') {
                body.classList.add('theme-light');
                toggle.textContent = '☀';
            } else {
                body.classList.remove('theme-light');
                toggle.textContent = '☾';
            }

            toggle.addEventListener('click', function () {
                var isLight = body.classList.toggle('theme-light');
                localStorage.setItem('campus-hub-theme', isLight ? 'light' : 'dark');
                toggle.textContent = isLight ? '☀' : '☾';
            });
        })();
    </script>
</body>
</html>
